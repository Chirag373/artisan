{% extends 'base.html' %}

{% block content %}

<div class="relative z-20 container mx-auto -mt-8 mb-12">
    <div class="bg-[#FEFCE8]/80 backdrop-blur-md rounded-2xl border border-gray-400 p-6">
        <form action="" method="GET" class="space-y-4 md:space-y-0 md:flex md:gap-4">
            <div class="flex-grow relative group">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <svg class="h-5 w-5 text-gray-400 group-focus-within:text-blue-500 transition-colors" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <input type="text" name="q" id="keywords"
                    class="block w-full pl-11 pr-4 py-4 bg-gray-50 border-transparent rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:bg-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-200"
                    placeholder="What are you looking for? (e.g. Pokemon, Digital Art)...">
            </div>

            <div class="w-full md:w-1/3 relative group">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <svg class="h-5 w-5 text-gray-400 group-focus-within:text-blue-500 transition-colors" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </div>
                <input type="text" name="location" id="location"
                    class="block w-full pl-11 pr-4 py-4 bg-gray-50 border-transparent rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:bg-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-200"
                    placeholder="City or Zip">
            </div>

            <button type="submit"
                class="w-full md:w-auto px-8 py-4 bg-gray-900 hover:bg-black text-white font-medium rounded-xl shadow-lg shadow-gray-900/10 transform hover:-translate-y-0.5 transition-all duration-200 flex items-center justify-center gap-2">
                <span>Search</span>
            </button>
        </form>
    </div>
</div>

<div id="featured-artists-grid"
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16 container mx-auto md:px-0">
    <!-- Cards will be dynamically inserted here -->
    <div class="col-span-full text-center py-12">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"></div>
        <p class="mt-2 text-gray-500">Loading artists...</p>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const grid = document.getElementById('featured-artists-grid');

        try {
            const response = await fetch('/api/featured-artists/');
            if (!response.ok) throw new Error('Failed to fetch artists');

            const artists = await response.json();

            if (artists.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <p class="text-gray-500">No artists found.</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = artists.map(artist => `
                <article class="group bg-[#FEFCE8] rounded-2xl border border-gray-400 shadow-sm hover:shadow-[0_8px_30px_rgb(0,0,0,0.04)] transition-all duration-300 flex flex-col h-full overflow-hidden">
                    <div class="relative h-40 w-full overflow-hidden bg-gray-100">
                        <img src="${artist.banner_image || 'https://images.unsplash.com/photo-1579783902614-a3fb39279c0f?q=80&w=800&auto=format&fit=crop'}"
                            alt="Cover" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                        ${artist.is_featured ? `
                        <div class="absolute top-4 right-4">
                            <span class="bg-white/90 backdrop-blur text-xs font-bold text-indigo-600 px-3 py-1 rounded-full shadow-sm flex items-center gap-1">
                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                </svg>
                                Featured
                            </span>
                        </div>
                        ` : ''}
                    </div>

                    <div class="px-6 pb-6 flex flex-col flex-grow relative">
                        <div class="-mt-10 mb-3 flex justify-between items-end">
                            <div class="relative">
                                <img src="${artist.profile_image || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(artist.artist_name)}"
                                    class="w-20 h-20 rounded-2xl border-4 border-[#FEFCE8] shadow-md object-cover bg-[#FEFCE8]"
                                    alt="${artist.artist_name}">
                            </div>
                        </div>

                        <div class="mb-3">
                            <h3 class="text-lg font-bold text-gray-900 group-hover:text-blue-600 transition-colors flex items-center gap-1">
                                ${artist.artist_name}
                            </h3>
                            <p class="text-sm text-gray-500 flex items-center gap-2">
                                <span>${artist.location_city || 'Unknown'}, ${artist.location_state || ''}</span>
                                ${artist.rating ? `
                                <span class="w-1 h-1 rounded-full bg-gray-300"></span>
                                <span class="text-amber-500 flex items-center gap-0.5 text-xs font-medium">
                                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                    </svg>
                                    ${artist.rating}
                                </span>
                                ` : ''}
                            </p>
                        </div>

                        <div class="flex flex-wrap gap-2 mb-4">
                            ${(artist.categories || []).slice(0, 3).map(cat => `
                                <span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors cursor-default">
                                    ${cat.replace('_', ' ')}
                                </span>
                            `).join('')}
                        </div>

                        <div class="text-gray-600 text-sm mb-6 leading-relaxed">
                            <p class="bio-text" data-full-text="${(artist.full_bio || 'No bio available.').replace(/"/g, '&quot;')}">
                                ${artist.full_bio && artist.full_bio.length > 120 
                                    ? artist.full_bio.substring(0, 120) + '...' 
                                    : (artist.full_bio || 'No bio available.')}
                            </p>
                            ${artist.full_bio && artist.full_bio.length > 120 ? `
                                <button class="read-more-btn text-blue-600 hover:text-blue-700 font-medium text-xs mt-1 focus:outline-none">
                                    Read More
                                </button>
                            ` : ''}
                        </div>

                        <div class="mt-auto pt-4 border-t border-gray-50">
                            <a href="/profile/${artist.slug}/"
                                class="w-full inline-flex items-center justify-center px-4 py-2.5 bg-[#FEFCE8] border border-gray-200 hover:border-blue-500 hover:text-blue-600 text-gray-700 text-sm font-semibold rounded-lg transition-all">
                                View Profile
                            </a>
                        </div>
                    </div>
                </article>
            `).join('');

            // Add event listeners for Read More/Less buttons
            document.querySelectorAll('.read-more-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const bioText = this.previousElementSibling;
                    const fullText = bioText.getAttribute('data-full-text');
                    const isExpanded = this.textContent === 'Read Less';
                    
                    if (isExpanded) {
                        bioText.textContent = fullText.substring(0, 120) + '...';
                        this.textContent = 'Read More';
                    } else {
                        bioText.textContent = fullText;
                        this.textContent = 'Read Less';
                    }
                });
            });

        } catch (error) {
            console.error('Error loading artists:', error);
            grid.innerHTML = `
                <div class="col-span-full text-center py-12">
                    <p class="text-red-500">Failed to load artists. Please try again later.</p>
                </div>
            `;
        }
    });
</script>
{% endblock %}